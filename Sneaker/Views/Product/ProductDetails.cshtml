@using System.Security.Claims
@using Sneaker.Utility
@model Sneaker.ViewModel.FeedbackProductViewModel

@{
    ViewBag.Title = "title";
    Layout = "_UserLayout";
}

<input id="ProductId" type="hidden" value="@Model.Product.Id">

<!-- product -->
<div class="product-content product-wrap clearfix product-deatil">
    <div class="row">
        <div class="col-md-5 col-sm-12 col-xs-12">
            <div class="product-image">
                <div id="myCarousel-2" class="carousel slide">
                    <ol class="carousel-indicators">
                        <li data-target="#myCarousel-2" data-slide-to="0" class=""></li>
                        <li data-target="#myCarousel-2" data-slide-to="1" class="active"></li>
                        <li data-target="#myCarousel-2" data-slide-to="2" class=""></li>
                    </ol>
                    <div class="carousel-inner">
                        <!-- Slide 1 -->
                        <div class="item active">
                            <img src="@Html.DisplayFor(p => p.Product.Image)" class="img-responsive" alt=""/>
                        </div>
                        <!-- Slide 2 -->
                        <div class="item">
                            <img src="@Html.DisplayFor(p => p.Product.Image)" class="img-responsive" alt=""/>
                        </div>
                        <!-- Slide 3 -->
                        <div class="item">
                            <img src="@Html.DisplayFor(p => p.Product.Image)" class="img-responsive" alt=""/>
                        </div>
                    </div>
                    <a class="left carousel-control" href="#myCarousel-2" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left"></span>
                    </a>
                    <a class="right carousel-control" href="#myCarousel-2" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right"></span>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-md-offset-1 col-sm-12 col-xs-12">
            <h2 class="name">
                @Html.DisplayFor(p => p.Product.ProductName)
            </h2>
            <hr/>
            <form class="form-horizontal qtyFrm" asp-action="AddCart" asp-controller="Cart" asp-route-id="@Model.Product.Id" method="post">
                <div class="control-group">
                    <h3 class="price-container">
                        $@Html.DisplayFor(p => p.Product.Price)
                    </h3>
                    <div class="controls">
                        <input type="number" min="1" name="quantity" value="1" class="span1" placeholder="Qty."/>
                    </div>
                </div>
                <hr/>
                <div class="row">
                    <div class="col-sm-12 col-md-6 col-lg-6">
                        <button type="submit" class="btn btn-success btn-lg">Add to cart</button>
                    </div>
                </div>
            </form>

            <hr/>

            <div class="description description-tabs">
                <ul id="myTab" class="nav nav-pills">
                    <li class="active">
                        <a href="#more-information" data-toggle="tab" class="no-margin">Product Description </a>
                    </li>
                    <li class="">
                        <a href="#reviews" data-toggle="tab">Reviews</a>
                    </li>
                </ul>
                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade active in" id="more-information">
                        <br/>
                        <strong>Description Title</strong>
                        <p>
                            @Html.DisplayFor(p => p.Product.Category)
                        </p>
                    </div>
                    <div class="tab-pane fade" id="reviews">
                        <br/>
                        <form method="post" class="well padding-bottom-10">
                            <textarea rows="2" id="messageInput" class="form-control" placeholder="Write a review"></textarea>
                            <div class="margin-top-10">
                                <button type="button" class="btn btn-sm btn-primary pull-right" id="sendButton">
                                    Submit Review
                                </button>
                                <a href="javascript:void(0);" class="btn btn-link profile-link-btn" rel="tooltip" data-placement="bottom" title="" data-original-title="Add Location">
                                    <i class="fa fa-location-arrow"></i>
                                </a>
                                <a href="javascript:void(0);" class="btn btn-link profile-link-btn" rel="tooltip" data-placement="bottom" title="" data-original-title="Add Voice">
                                    <i class="fa fa-microphone"></i>
                                </a>
                                <a href="javascript:void(0);" class="btn btn-link profile-link-btn" rel="tooltip" data-placement="bottom" title="" data-original-title="Add Photo">
                                    <i class="fa fa-camera"></i>
                                </a>
                                <a href="javascript:void(0);" class="btn btn-link profile-link-btn" rel="tooltip" data-placement="bottom" title="" data-original-title="Add File">
                                    <i class="fa fa-file"></i>
                                </a>
                            </div>
                        </form>

                        @foreach (var feedback in Model.feedbackProducts)
                        {
                            <div class="chat-body no-padding profile-message">
                                <ul>
                                    <li class="message">
                                        @if (feedback.ApplicationUser.ImagePath == null)
                                        {
                                            <img src="avatars/avatar.jpeg" class="online" height="30px" width="30px" alt=""/>
                                        }
                                        else
                                        {
                                            <img src="avatars/@feedback.ApplicationUser.ImagePath" class="online" height="30px" width="30px" alt=""/>
                                        }
                                        <span class="message-text">
                                            <a href="javascript:void(0);" class="username">
                                                @feedback.ApplicationUser.FullName
                                            </a>
                                            @feedback.Message
                                        </span>
                                        <ul class="list-inline font-xs">
                                            <li class="pull-right">
                                                <small class="text-muted pull-right ultra-light"> @feedback.CreateAt </small>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <hr/>
        </div>
    </div>
</div>
<!-- end product -->
<div id="rate"></div>
<input type="hidden" id="rating"/>

@section Scripts{
    <script>
        $("#sendButton").click(function () {
            let message = document.getElementById("messageInput").value;
            let productId = document.getElementById("ProductId").value;
            $.ajax({
                url: '/Product/SendFeedback',
                type: 'POST',
                data: {productId: productId, message: message},
                success: function (response) {
                    if (!response.success){
                        $('#MessageResult').html('<div class="d-flex flex-row mb-2 alert alert-warning alert-dismissible mt-2"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>' +response.message + '</div>');
                    }
                    else{
                        setTimeout(function () {
                            location.reload();
                        },100);
                    }
                },
                error: function () {
        
                }
            })
        });
    </script>

}