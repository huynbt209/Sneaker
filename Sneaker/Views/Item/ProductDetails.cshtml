@using System.Security.Claims
@using Sneaker.Utility
@model Sneaker.ViewModel.FeedbackItemViewModel

@{
    ViewBag.Title = "title";
    Layout = "_UserLayout";
}

<input id="ProductId" type="hidden" value="@Model.Items.Id">

<!-- product -->
<div class="product-content product-wrap clearfix product-deatil">
    <div class="row">
        <div class="col-md-5 col-sm-12 col-xs-12">
            <div class="product-image">
                <div id="myCarousel-2" class="carousel slide">
                    <ol class="carousel-indicators">
                        <li data-target="#myCarousel-2" data-slide-to="0" class=""></li>
                        <li data-target="#myCarousel-2" data-slide-to="1" class="active"></li>
                        <li data-target="#myCarousel-2" data-slide-to="2" class=""></li>
                    </ol>
                    <div class="carousel-inner">
                        <!-- Slide 1 -->
                        <div class="item active">
                            <img src="@Html.DisplayFor(p => p.Items.Image)" class="img-responsive" alt=""/>
                        </div>
                        <!-- Slide 2 -->
                        <div class="item">
                            <img src="@Html.DisplayFor(p => p.Items.Image)" class="img-responsive" alt=""/>
                        </div>
                        <!-- Slide 3 -->
                        <div class="item">
                            <img src="@Html.DisplayFor(p => p.Items.Image)" class="img-responsive" alt=""/>
                        </div>
                    </div>
                    <a class="left carousel-control" href="#myCarousel-2" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left"></span>
                    </a>
                    <a class="right carousel-control" href="#myCarousel-2" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right"></span>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-md-offset-1 col-sm-12 col-xs-12">
            <h2 class="name">
                @Html.DisplayFor(p => p.Items.ProductName)
            </h2>
            <hr/>
            <form class="form-horizontal qtyFrm">
                <div class="control-group">
                    <h3 class="price-container">
                        $@Html.DisplayFor(p => p.Items.Price)
                    </h3>
                    <div class="input-append">
                        <input class="span1" style="max-width: 60px" placeholder="1" id="appendedInputButtons" size="20"
                               type="number" min="1" name="quantity" disabled/>
                        @* <button class="btn" type="submit"> *@
                        @*     <i class="fa fa-refresh" aria-hidden="true"></i> *@
                        @* </button> *@
                    </div>
                </div>
                <hr/>
                <div class="row">
                    <div class="col-sm-12 col-md-6 col-lg-6">
                        <a type="button" class="add-to-cart btn btn-success btn-lg" data-id="@Model.Items.Id">Add to cart</a>
                    </div>
                </div>
            </form>

            <hr/>

            <div class="description description-tabs">
                <ul id="myTab" class="nav nav-pills">
                    <li class="active">
                        <a href="#more-information" data-toggle="tab" class="no-margin">Product Description </a>
                    </li>
                    <li class="">
                        <a href="#reviews" data-toggle="tab">Reviews</a>
                    </li>
                </ul>
                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade active in" id="more-information">
                        <br/>
                        <strong>Description Title</strong>
                        <p>
                            @Html.DisplayFor(p => p.Items.Category)
                        </p>
                    </div>
                    <div class="tab-pane fade" id="reviews">
                        <br/>
                        <form method="post" class="well padding-bottom-10">
                            <textarea rows="2" id="messageInput" class="form-control" placeholder="Write a review"></textarea>
                            <div class="margin-top-10">
                                <button type="button" class="btn btn-sm btn-primary pull-right" id="sendButton">
                                    Submit Review
                                </button>
                            </div>
                        </form>

                        @foreach (var feedback in Model.FeedbackItems)
                        {
                            <div class="chat-body no-padding profile-message">
                                <ul>
                                    <li class="message">
                                        @if (feedback.ApplicationUser.ImagePath == null)
                                        {
                                            <img src="avatars/avatar.jpeg" class="online" height="40" width="40" alt=""/>
                                        }
                                        else
                                        {
                                            <img id="userAvatarComment" src="avatars/@feedback.ApplicationUser.ImagePath" class="online" height="40" width="40" alt="User Avatar"/>
                                        }
                                        <span class="message-text">
                                            <a href="javascript:void(0);" class="username">
                                                @feedback.ApplicationUser.FullName
                                            </a>
                                            @feedback.Message
                                        </span>
                                        <ul class="list-inline font-xs">
                                            <li class="pull-right">
                                                <small class="text-muted pull-right ultra-light"> @feedback.CreateAt </small>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <hr/>
        </div>
    </div>
</div>
<!-- end product -->

@section Scripts{
    <script>
        $("#sendButton").click(function () {
            let message = document.getElementById("messageInput").value;
            let productId = document.getElementById("ProductId").value;
            $.ajax({
                url: '/Item/SendFeedback',
                type: 'POST',
                data: { productId: productId, message: message },
                success: function (response) {
                    if (!response.success) {
                        $('#MessageResult').html('<div class="d-flex flex-row mb-2 alert alert-warning alert-dismissible mt-2"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>' + response.message + '</div>');
                    }
                    else {
                        setTimeout(function () {
                            location.reload();
                        }, 100);
                    }
                },
                error: function () {
                }
            })
        });
    </script>

}